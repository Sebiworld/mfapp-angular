<ion-header>
  <app-header [title]="'calendar.title' | translate" [backDefault]="'/calendar'"></app-header>
</ion-header>

<ion-content>
  <form [formGroup]="eventForm">
    <ion-card>
      <ion-card-content>
        <ion-list class="form-list" lines="none">
          <ion-item *ngIf="eventForm.controls.title">
            <ion-input formControlName="title" label-placement="floating" fill="solid">
              <div slot="label">
                {{ 'calendar.event.title' | translate }} <ion-text *ngIf="eventForm.controls.title.validator"
                  color="danger" [title]="'general.required' | translate">&ast;</ion-text>
              </div>
            </ion-input>
          </ion-item>

          <ion-item *ngIf="eventForm.controls.description">
            <ion-textarea formControlName="description" label-placement="floating" fill="solid" [autoGrow]="true">
              <div slot="label">
                {{ 'calendar.event.description' | translate }} <ion-text
                  *ngIf="eventForm.controls.description.validator" color="danger"
                  [title]="'general.required' | translate">&ast;</ion-text>
              </div>
            </ion-textarea>
          </ion-item>
        </ion-list>
      </ion-card-content>
    </ion-card>

    <div class="timespan-wrapper" formArrayName="timespans"
      *ngFor="let timespan of timespans.controls; let index = index">
      <ion-card [formGroupName]="index">
        <ion-card-header>
          <ion-card-subtitle>{{ 'calendar.event.timespans' | translate }}</ion-card-subtitle>
        </ion-card-header>
        <ion-card-content>
          <ion-list class="form-list" lines="none">
            <ion-item button (click)="openTimespanPicker($event, index, timespan.value.timeFrom, timespan.value.timeUntil)">
              <div *ngIf="[timespan.value.timeFrom, timespan.value.timeUntil] | areDatesEqual: 'day'">
                {{ [timespan.value.timeFrom, currentDate] | dateWithFallback: 'medium' : locale }}
                <span class="date-spacer">-</span>
                {{ [timespan.value.timeUntil, currentDate] | dateWithFallback: 'mediumTime' : locale }}
              </div>

              <div *ngIf="[timespan.value.timeFrom, timespan.value.timeUntil] | areDatesEqual: 'day': true">
                {{ [timespan.value.timeFrom, currentDate] | dateWithFallback: 'medium' : locale }}
                <span class="date-spacer">-</span>
                {{ [timespan.value.timeUntil, currentDate] | dateWithFallback: 'medium' : locale }}
              </div>
            </ion-item>

            <ion-item>
              <ion-input formControlName="title" label-placement="floating" fill="solid"
                [label]="'calendar.event.title' | translate">
              </ion-input>
            </ion-item>
          </ion-list>
        </ion-card-content>
      </ion-card>
    </div>
  </form>
</ion-content>